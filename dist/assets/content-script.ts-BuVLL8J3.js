var a=Object.defineProperty;var d=(i,e,t)=>e in i?a(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var s=(i,e,t)=>d(i,typeof e!="symbol"?e+"":e,t);class h{constructor(){s(this,"events",[]);s(this,"isRecording",!1);s(this,"startTime",0);s(this,"rafId",null);s(this,"lastMouseEvent",null);s(this,"handleMouseMove",e=>{this.isRecording&&(this.lastMouseEvent=e,this.rafId||(this.rafId=requestAnimationFrame(this.processMouseMove)))});s(this,"processMouseMove",()=>{if(!this.lastMouseEvent||!this.isRecording){this.rafId=null;return}const e=this.lastMouseEvent,t=Date.now()-this.startTime;this.events.push({x:e.clientX,y:e.clientY,timestamp:t,type:"move"}),this.rafId=null});s(this,"handleClick",e=>{if(!this.isRecording)return;const t=Date.now()-this.startTime;this.events.push({x:e.clientX,y:e.clientY,timestamp:t,type:"click"})})}start(){this.isRecording=!0,this.events=[],this.startTime=Date.now(),window.addEventListener("mousemove",this.handleMouseMove,{capture:!0}),window.addEventListener("click",this.handleClick,{capture:!0}),console.log("Metadata recorder started")}async stop(){return this.isRecording=!1,window.removeEventListener("mousemove",this.handleMouseMove,{capture:!0}),window.removeEventListener("click",this.handleClick,{capture:!0}),this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.lastMouseEvent=null,console.log("Metadata recorder stopped",this.events),this.events}getEvents(){return this.events}}const n=new h;typeof chrome<"u"&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener((i,e,t)=>{if(i.type==="GET_DIMENSIONS")t({width:window.innerWidth,height:window.innerHeight,dpr:window.devicePixelRatio});else if(i.type==="START_RECORDING")n.start(),t({status:"started"});else if(i.type==="STOP_RECORDING")return n.stop().then(r=>{const o={width:window.innerWidth,height:window.innerHeight,dpr:window.devicePixelRatio};t({status:"stopped",data:{events:r,viewport:o}})}),!0});export{h as MetadataRecorder};
